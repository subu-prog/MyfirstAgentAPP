<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAI Responses API Explorer</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        header p {
            color: #888;
            font-size: 1.1rem;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 320px 1fr 350px;
            gap: 20px;
            min-height: calc(100vh - 180px);
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .panel h2 {
            font-size: 1.1rem;
            color: #00d9ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel h2 span {
            font-size: 1.2rem;
        }

        /* Config Panel */
        .config-group {
            margin-bottom: 15px;
        }

        .config-group label {
            display: block;
            font-size: 0.85rem;
            color: #aaa;
            margin-bottom: 5px;
        }

        .config-group input,
        .config-group select,
        .config-group textarea {
            width: 100%;
            padding: 10px 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: #fff;
            font-size: 0.9rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .config-group input:focus,
        .config-group select:focus,
        .config-group textarea:focus {
            outline: none;
            border-color: #00d9ff;
        }

        .config-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .tool-toggles {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .tool-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .tool-toggle:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .tool-toggle input {
            width: 18px;
            height: 18px;
            accent-color: #00ff88;
        }

        .tool-toggle .tool-info {
            flex: 1;
        }

        .tool-toggle .tool-name {
            font-size: 0.9rem;
            color: #fff;
        }

        .tool-toggle .tool-desc {
            font-size: 0.75rem;
            color: #888;
        }

        /* Chat Panel */
        .chat-panel {
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 15px;
            min-height: 400px;
            max-height: 600px;
        }

        .message {
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-header {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 12px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #00d9ff33, #00d9ff11);
            border: 1px solid #00d9ff44;
            margin-left: 40px;
        }

        .message.assistant .message-content {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-right: 40px;
        }

        .message.tool .message-content {
            background: linear-gradient(135deg, #ff990033, #ff990011);
            border: 1px solid #ff990044;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
        }

        .message.error .message-content {
            background: linear-gradient(135deg, #ff444433, #ff444411);
            border: 1px solid #ff444444;
        }

        .message.system .message-content {
            background: linear-gradient(135deg, #00ff8833, #00ff8811);
            border: 1px solid #00ff8844;
            text-align: center;
            font-style: italic;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
        }

        .chat-input-area input {
            flex: 1;
            padding: 14px 18px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
        }

        .chat-input-area input:focus {
            outline: none;
            border-color: #00d9ff;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d9ff, #00ff88);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 217, 255, 0.3);
        }

        .btn-primary:disabled {
            background: #555;
            color: #888;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .chat-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .chat-actions .btn {
            flex: 1;
            padding: 10px;
            font-size: 0.85rem;
        }

        /* Inspector Panel */
        .inspector-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .inspector-tab {
            flex: 1;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid transparent;
            border-radius: 8px;
            color: #888;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .inspector-tab:hover {
            color: #fff;
        }

        .inspector-tab.active {
            background: rgba(0, 217, 255, 0.15);
            border-color: #00d9ff;
            color: #00d9ff;
        }

        .inspector-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            overflow: auto;
            max-height: 500px;
        }

        .inspector-content pre {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8rem;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-all;
            color: #ccc;
        }

        .json-key { color: #00d9ff; }
        .json-string { color: #00ff88; }
        .json-number { color: #ff9900; }
        .json-boolean { color: #ff6b6b; }
        .json-null { color: #888; }

        /* Conversation Chain */
        .conversation-chain {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chain-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chain-item:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .chain-item.active {
            border: 1px solid #00d9ff;
        }

        .chain-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00ff88;
        }

        .chain-info {
            flex: 1;
            overflow: hidden;
        }

        .chain-id {
            font-size: 0.75rem;
            color: #00d9ff;
            font-family: monospace;
        }

        .chain-preview {
            font-size: 0.8rem;
            color: #888;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Examples */
        .examples {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .examples h3 {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 5px;
        }

        .example-btn {
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #ccc;
            font-size: 0.85rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
        }

        .example-btn:hover {
            background: rgba(0, 217, 255, 0.1);
            border-color: #00d9ff44;
            color: #fff;
        }

        /* Loading indicator */
        .loading {
            display: inline-flex;
            gap: 4px;
        }

        .loading span {
            width: 8px;
            height: 8px;
            background: #00d9ff;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .loading span:nth-child(1) { animation-delay: -0.32s; }
        .loading span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.8rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #888;
        }

        .status-dot.connected { background: #00ff88; }
        .status-dot.error { background: #ff4444; }

        .info-box {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 0.8rem;
            color: #aaa;
        }

        .info-box code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            color: #00ff88;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ OpenAI Responses API Explorer</h1>
            <p>Learn and test the new Responses API with built-in tools and conversation chaining</p>
        </header>

        <div class="main-layout">
            <!-- Config Panel -->
            <div class="panel config-panel">
                <h2><span>‚öôÔ∏è</span> Configuration</h2>
                
                <div class="config-group">
                    <label>API Key</label>
                    <input type="password" id="api-key" placeholder="sk-...">
                </div>

                <div class="config-group">
                    <label>Model</label>
                    <select id="model">
                        <option value="gpt-4o">gpt-4o</option>
                        <option value="gpt-4o-mini">gpt-4o-mini</option>
                        <option value="gpt-4.1">gpt-4.1</option>
                        <option value="gpt-4.1-mini">gpt-4.1-mini</option>
                        <option value="gpt-4.1-nano">gpt-4.1-nano</option>
                    </select>
                </div>

                <div class="config-group">
                    <label>Instructions (System Prompt)</label>
                    <textarea id="instructions" placeholder="You are a helpful assistant...">You are a helpful assistant. Be concise and informative. When using tools, explain what you're doing.</textarea>
                </div>

                <div class="config-group">
                    <label>Built-in Tools</label>
                    <div class="tool-toggles">
                        <label class="tool-toggle">
                            <input type="checkbox" id="tool-web-search">
                            <div class="tool-info">
                                <div class="tool-name">üåê Web Search</div>
                                <div class="tool-desc">Search the web for current information</div>
                            </div>
                        </label>
                        <label class="tool-toggle">
                            <input type="checkbox" id="tool-code-interpreter">
                            <div class="tool-info">
                                <div class="tool-name">üíª Code Interpreter</div>
                                <div class="tool-desc">Execute Python code for calculations</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="config-group">
                    <label>
                        <input type="checkbox" id="store-conversation"> Store conversation server-side
                    </label>
                </div>

                <div class="examples">
                    <h3>Try these examples:</h3>
                    <button class="example-btn" onclick="tryExample('web')">üåê "What's the latest news about AI?"</button>
                    <button class="example-btn" onclick="tryExample('code')">üíª "Calculate first 20 Fibonacci numbers"</button>
                    <button class="example-btn" onclick="tryExample('chain')">üîó "Remember: my favorite color is blue"</button>
                    <button class="example-btn" onclick="tryExample('recall')">üîó "What's my favorite color?"</button>
                </div>
            </div>

            <!-- Chat Panel -->
            <div class="panel chat-panel">
                <h2><span>üí¨</span> Chat</h2>
                
                <div class="status-bar">
                    <div class="status-indicator">
                        <div class="status-dot" id="status-dot"></div>
                        <span id="status-text">Enter API key to start</span>
                    </div>
                    <span id="response-id">No response yet</span>
                </div>

                <div class="chat-messages" id="chat-messages">
                    <div class="message system">
                        <div class="message-content">
                            Welcome! This explorer helps you learn the OpenAI Responses API.<br><br>
                            <strong>Key features to explore:</strong><br>
                            ‚Ä¢ Built-in tools (web search, code interpreter)<br>
                            ‚Ä¢ Conversation chaining with previous_response_id<br>
                            ‚Ä¢ Server-side storage option<br><br>
                            Enter your API key and start chatting!
                        </div>
                    </div>
                </div>

                <div class="chat-input-area">
                    <input type="text" id="user-input" placeholder="Type your message..." onkeypress="if(event.key==='Enter') sendMessage()">
                    <button class="btn btn-primary" id="send-btn" onclick="sendMessage()">Send</button>
                </div>

                <div class="chat-actions">
                    <button class="btn btn-secondary" onclick="clearChat()">üóëÔ∏è Clear Chat</button>
                    <button class="btn btn-secondary" onclick="clearChain()">üîó New Chain</button>
                </div>
            </div>

            <!-- Inspector Panel -->
            <div class="panel inspector-panel">
                <h2><span>üîç</span> Inspector</h2>

                <div class="info-box">
                    üí° <strong>Tip:</strong> The code_interpreter tool requires a <code>container</code> parameter. This app uses <code>"type": "auto"</code> which lets OpenAI choose the environment.
                </div>

                <div class="inspector-tabs">
                    <button class="inspector-tab active" onclick="switchTab('request')">Request</button>
                    <button class="inspector-tab" onclick="switchTab('response')">Response</button>
                    <button class="inspector-tab" onclick="switchTab('chain')">Chain</button>
                </div>

                <div class="inspector-content" id="inspector-content">
                    <pre id="inspector-json">// Make a request to see the JSON here

// Code Interpreter requires:
{
  "type": "code_interpreter",
  "container": {
    "type": "auto"
  }
}

// Web Search format:
{
  "type": "web_search_preview"
}</pre>
                </div>

                <div class="conversation-chain" id="conversation-chain" style="display: none; margin-top: 15px;">
                    <h3 style="font-size: 0.9rem; color: #888; margin-bottom: 10px;">Response Chain:</h3>
                    <div id="chain-items"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let conversationHistory = [];
        let responseChain = [];
        let lastResponseId = null;
        let lastRequest = null;
        let lastResponse = null;
        let currentTab = 'request';
        let isLoading = false;

        // DOM elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const apiKeyInput = document.getElementById('api-key');
        const modelSelect = document.getElementById('model');
        const instructionsInput = document.getElementById('instructions');
        const webSearchTool = document.getElementById('tool-web-search');
        const codeInterpreterTool = document.getElementById('tool-code-interpreter');
        const storeConversation = document.getElementById('store-conversation');
        const sendBtn = document.getElementById('send-btn');
        const statusDot = document.getElementById('status-dot');
        const statusText = document.getElementById('status-text');
        const responseIdDisplay = document.getElementById('response-id');
        const inspectorJson = document.getElementById('inspector-json');
        const chainItems = document.getElementById('chain-items');
        const conversationChainDiv = document.getElementById('conversation-chain');

        // Update status
        function updateStatus(status, text) {
            statusDot.className = 'status-dot ' + status;
            statusText.textContent = text;
        }

        // Add message to chat
        function addMessage(role, content, toolInfo = null) {
            const div = document.createElement('div');
            div.className = `message ${role}`;
            
            let icon = '';
            let label = '';
            switch(role) {
                case 'user': icon = 'üë§'; label = 'You'; break;
                case 'assistant': icon = 'ü§ñ'; label = 'Assistant'; break;
                case 'tool': icon = 'üîß'; label = toolInfo || 'Tool'; break;
                case 'error': icon = '‚ùå'; label = 'Error'; break;
                case 'system': icon = '‚ÑπÔ∏è'; label = 'System'; break;
            }

            div.innerHTML = `
                <div class="message-header">${icon} ${label}</div>
                <div class="message-content">${formatContent(content)}</div>
            `;
            
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return div;
        }

        // Format content (handle code blocks, etc.)
        function formatContent(content) {
            if (typeof content !== 'string') {
                content = JSON.stringify(content, null, 2);
            }
            return content
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\n/g, '<br>')
                .replace(/`([^`]+)`/g, '<code style="background:rgba(0,0,0,0.3);padding:2px 6px;border-radius:4px;">$1</code>');
        }

        // Syntax highlight JSON
        function highlightJson(json) {
            const str = JSON.stringify(json, null, 2);
            return str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"([^"]+)":/g, '<span class="json-key">"$1"</span>:')
                .replace(/: "([^"]*)"/g, ': <span class="json-string">"$1"</span>')
                .replace(/: (\d+\.?\d*)/g, ': <span class="json-number">$1</span>')
                .replace(/: (true|false)/g, ': <span class="json-boolean">$1</span>')
                .replace(/: null/g, ': <span class="json-null">null</span>');
        }

        // Switch inspector tab
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.inspector-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.inspector-tab:nth-child(${tab === 'request' ? 1 : tab === 'response' ? 2 : 3})`).classList.add('active');
            
            conversationChainDiv.style.display = tab === 'chain' ? 'block' : 'none';
            
            updateInspector();
        }

        // Update inspector content
        function updateInspector() {
            if (currentTab === 'request' && lastRequest) {
                inspectorJson.innerHTML = highlightJson(lastRequest);
            } else if (currentTab === 'response' && lastResponse) {
                inspectorJson.innerHTML = highlightJson(lastResponse);
            } else if (currentTab === 'chain') {
                renderChain();
                inspectorJson.innerHTML = responseChain.length > 0 
                    ? highlightJson(responseChain.map(r => ({ id: r.id, preview: r.preview })))
                    : '// No response chain yet';
            } else if (!lastRequest && !lastResponse) {
                inspectorJson.innerHTML = `// Make a request to see the JSON here

// Code Interpreter requires:
{
  "type": "code_interpreter",
  "container": {
    "type": "auto"
  }
}

// Web Search format:
{
  "type": "web_search_preview"
}`;
            }
        }

        // Render conversation chain
        function renderChain() {
            chainItems.innerHTML = responseChain.map((item, i) => `
                <div class="chain-item ${item.id === lastResponseId ? 'active' : ''}" onclick="viewChainItem(${i})">
                    <div class="chain-dot"></div>
                    <div class="chain-info">
                        <div class="chain-id">${item.id}</div>
                        <div class="chain-preview">${item.preview}</div>
                    </div>
                </div>
            `).join('');
        }

        // View chain item
        function viewChainItem(index) {
            const item = responseChain[index];
            if (item && item.fullResponse) {
                lastResponse = item.fullResponse;
                switchTab('response');
            }
        }

        // Build request body - FIXED: Added container for code_interpreter
        function buildRequestBody(message) {
            const body = {
                model: modelSelect.value,
                input: message
            };

            const instructions = instructionsInput.value.trim();
            if (instructions) {
                body.instructions = instructions;
            }

            // Add tools if selected - FIXED TOOL FORMAT
            const tools = [];
            if (webSearchTool.checked) {
                tools.push({ type: 'web_search_preview' });
            }
            if (codeInterpreterTool.checked) {
                // FIXED: Code interpreter requires a container parameter
                tools.push({ 
                    type: 'code_interpreter',
                    container: {
                        type: 'auto'  // Let OpenAI choose the appropriate container
                    }
                });
            }
            if (tools.length > 0) {
                body.tools = tools;
            }

            // Add previous response ID for chaining
            if (lastResponseId) {
                body.previous_response_id = lastResponseId;
            }

            // Store conversation server-side
            if (storeConversation.checked) {
                body.store = true;
            }

            return body;
        }

        // Parse response output - handles various response formats
        function parseResponseOutput(response) {
            const outputs = [];
            
            if (response.output && Array.isArray(response.output)) {
                for (const item of response.output) {
                    if (item.type === 'message') {
                        for (const content of item.content || []) {
                            if (content.type === 'output_text') {
                                outputs.push({ type: 'text', content: content.text });
                            } else if (content.type === 'text') {
                                outputs.push({ type: 'text', content: content.text });
                            }
                        }
                    } else if (item.type === 'web_search_call') {
                        outputs.push({ type: 'tool', name: 'Web Search', content: `Searching: "${item.query || 'web'}"` });
                    } else if (item.type === 'code_interpreter_call') {
                        const code = item.input || item.code || 'Running code...';
                        outputs.push({ type: 'tool', name: 'Code Interpreter', content: code });
                    } else if (item.type === 'code_interpreter_result') {
                        const result = item.output || item.result || 'Completed';
                        outputs.push({ type: 'tool', name: 'Code Result', content: typeof result === 'string' ? result : JSON.stringify(result) });
                    } else if (item.type === 'function_call') {
                        outputs.push({ type: 'tool', name: item.name, content: JSON.stringify(item.arguments) });
                    }
                }
            }

            // Fallback for different response structures
            if (outputs.length === 0 && response.output_text) {
                outputs.push({ type: 'text', content: response.output_text });
            }

            // Another fallback - check for direct text in output
            if (outputs.length === 0 && typeof response.output === 'string') {
                outputs.push({ type: 'text', content: response.output });
            }

            return outputs;
        }

        // Send message
        async function sendMessage() {
            const message = userInput.value.trim();
            const apiKey = apiKeyInput.value.trim();

            if (!message) return;
            if (!apiKey) {
                addMessage('error', 'Please enter your API key in the configuration panel.');
                return;
            }

            // Disable input while loading
            isLoading = true;
            sendBtn.disabled = true;
            userInput.value = '';
            updateStatus('connected', 'Sending request...');

            // Add user message to chat
            addMessage('user', message);
            conversationHistory.push({ role: 'user', content: message });

            // Build request
            const requestBody = buildRequestBody(message);
            lastRequest = requestBody;
            updateInspector();

            // Add loading indicator
            const loadingDiv = addMessage('assistant', '<div class="loading"><span></span><span></span><span></span></div>');

            try {
                const response = await fetch('https://api.openai.com/v1/responses', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                lastResponse = data;

                // Remove loading indicator
                loadingDiv.remove();

                if (data.error) {
                    throw new Error(data.error.message || 'API request failed');
                }

                // Store response ID for chaining
                if (data.id) {
                    lastResponseId = data.id;
                    responseIdDisplay.textContent = `ID: ${data.id.slice(0, 20)}...`;
                    
                    // Add to chain
                    const preview = message.slice(0, 30) + (message.length > 30 ? '...' : '');
                    responseChain.push({
                        id: data.id,
                        preview: preview,
                        fullResponse: data
                    });
                }

                // Parse and display outputs
                const outputs = parseResponseOutput(data);
                
                if (outputs.length === 0) {
                    addMessage('assistant', 'Response received. Check the Inspector ‚Üí Response tab for raw data.');
                } else {
                    for (const output of outputs) {
                        if (output.type === 'tool') {
                            addMessage('tool', output.content, output.name);
                        } else {
                            addMessage('assistant', output.content);
                            conversationHistory.push({ role: 'assistant', content: output.content });
                        }
                    }
                }

                updateStatus('connected', 'Ready');
                updateInspector();

            } catch (error) {
                loadingDiv.remove();
                addMessage('error', error.message);
                updateStatus('error', 'Request failed');
                console.error('API Error:', error);
            }

            isLoading = false;
            sendBtn.disabled = false;
        }

        // Try example prompts
        function tryExample(type) {
            switch(type) {
                case 'web':
                    webSearchTool.checked = true;
                    userInput.value = "What's the latest news about AI agents?";
                    break;
                case 'code':
                    codeInterpreterTool.checked = true;
                    userInput.value = "Calculate the first 20 Fibonacci numbers and show them in a formatted list";
                    break;
                case 'chain':
                    userInput.value = "Remember this: my favorite color is blue and my lucky number is 7";
                    break;
                case 'recall':
                    userInput.value = "What's my favorite color and lucky number that I told you earlier?";
                    break;
            }
            userInput.focus();
        }

        // Clear chat
        function clearChat() {
            chatMessages.innerHTML = '';
            conversationHistory = [];
            addMessage('system', 'Chat cleared. Your response chain is preserved for testing continuation.');
        }

        // Clear chain (start fresh)
        function clearChain() {
            lastResponseId = null;
            responseChain = [];
            responseIdDisplay.textContent = 'No response yet';
            chainItems.innerHTML = '';
            addMessage('system', 'Response chain cleared. Next message starts a new conversation.');
            updateInspector();
        }

        // API key validation
        apiKeyInput.addEventListener('input', () => {
            const hasKey = apiKeyInput.value.trim().length > 0;
            updateStatus(hasKey ? 'connected' : '', hasKey ? 'Ready' : 'Enter API key to start');
        });
    </script>
</body>
</html>
What I fixed:

The code_interpreter tool requires a container parameter. The corrected format is:

{
    type: 'code_interpreter',
    container: {
        type: 'auto'  // Lets OpenAI choose the appropriate environment
    }
}
